# Pairs Analytics

### Important Note
This project is both a proof of concept and a work in progress.

I make no representation about the suitability of the information or data generated or described by the code for any purpose.
It is provided "as is" without express or implied warranty.
<b>
Put simply, any output or insight generated by this code, or any code derived from this code, should not be relied upon for 
making any investment decision.
</b>

### Overview
This project contains a web app for identifying pairs trading opportunities.
Specifically, this is a Flask app with an embedded Bokeh app.

The project is initialised to run on the pair Shell and BP.
This can be modified by updating the `tickers` variable in the `bkapp(...)` function of pairs_analytics.py.

### Strategy
Pairs trading seeks to find a (dollar neutral) portfolio of securities whose overall time series is stationary.
Mean reversion of the series is then exploited to capture alpha.

A portfolio is constructed from a pair of securities is constructed as

![pair portfolio equation](https://latex.codecogs.com/svg.latex?p_\mathrm{pair}(t)=p_\mathrm{A}(t)+k(t)\cdot{}p_\mathrm{B}(t))

where p is price,
A and B are the labels of the specific securities comprising the portfolio,
and k is the hedge ratio.

One key challenge of identifying pairs trading opportunities is the fact that company fundamentals are subject to 
change over time, for example a weakening of one company's strength relative to the other company.
Changes in the company fundamentals are reflected by shifts in the portfolio weights that are used to construct
the combined time series.
The code seeks to identify high likelihood periods where the fundamentals have shifted,
and adjust the portfolio weights in order to aid the identification of pair formation potential.

The code achieves this by modelling the hedge ratio as a time-dependent quantity.
The ratio is modelled using a specific form of the generalised logistic function.
A logistic function is used in order to model a smooth transition from one environment of economic fundamentals to another.
The specific form of this function is given by

![generalised logistic equation](https://latex.codecogs.com/svg.latex?k(t)=l+\frac{m-l}{1+e^{-k(t-a)}}) 

where t is the time,
l is the left asymptote,
m is right asymptote,
k is the sigmoid steepness,
and a is the sigmoid midpoint shift.

In the model, the hedge ratio is varied to minimise the absolute error of prices.
The corresponding least absolute deviations cost function, g(k), is

![cost function](https://latex.codecogs.com/svg.latex?g(k)=\sum_{t=0}^{t_\mathrm{max}}|p_\mathrm{A}(t)-k(t)\cdot{}p_\mathrm{B}(t)|)

where t is over discrete values of the time domain.
Overall, this procedure therefore introduces a degree of freedom into the portfolio construction that
represents a change in the relative strengths of the company fundamentals.

### Installation
The code requires the packages detailed in `requirements.txt` to be installed,
e.g. by calling in a virtual environment console,
```
$ pip install -r requirements.txt
```

### Usage
#### Running the app
The app can then be ran by calling the following at the command line:
```
$ python pairs_analytics.py
```

Following this, the app will run on [http://127.0.0.1:8000](http://127.0.0.1:8000), which can be accessed via a web browser.

#### Using the app
In the app, the pairs factor slider can be adjusted to visualise the pairs price series 
calculated using a specific price factor value.
* The weighted stock price series is given by the left hand <i>y</i>-axis in the upper plot.
* The portfolio spread is shown in the lower plot.

[comment]: <> (For an example pair portfolio consisting of Shell and BP:)

[comment]: <> (![Pair factor slider]&#40;docs/pairs_factor_slider.gif&#41;)

The "Find Discontinuity" button can be used to isolate discontinuities. 
On clicking this button, the optimisation is started.

[comment]: <> (For an example pair portfolio consisting of Shell and BP:)

[comment]: <> (![RDSA and BP pair discontinuity search]&#40;docs/find_discontinuity_rdsb_bp.gif&#41;)

[comment]: <> (For an example pair portfolio consisting of National Grid and SSE:)

[comment]: <> (![NG and SSE pair discontinuity search]&#40;docs/find_discontinuity_ng_sse.gif&#41;)

### Code Limitations
* The model only allows for a single discontinuation.
